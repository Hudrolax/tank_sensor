# Tank Sensor & Pump Controller (ESP8266 / NodeMCU v2)

Автономный контроллер наполнения бака на **ESP8266 (NodeMCU v2)**.  
Работает локально (режим **AUTO**) и/или через **MQTT**/**Home Assistant** (режим **EXTERNAL**).  
Поддерживает **MQTT Discovery** (создаёт `binary_sensor`, `switch`, `select`).

---

## Возможности

- Датчик уровня (дискретный): **LOW = бак ПОЛНЫЙ**  
- Насос через твердотельное реле: **HIGH = насос ВКЛ**
- Два режима работы:
  - **AUTO** – автономно включает/выключает насос по датчику (интернет/ MQTT не нужен)
  - **EXTERNAL** – встроенная логика выключена; управляет внешняя система по MQTT
- Встроенный LED: горит, когда **бак полный**
- Веб-страница статуса
- mDNS: `http://<device_name>.lan`
- Настройки (MQTT/режим/периоды) сохраняются в **LittleFS** (`/config.json`)
- Антидребезг входа (N подтверждений подряд)
- Заводской сброс по пину (см. ниже)

---

## Аппаратная схема (пины)

| Назначение            | Пин платы | GPIO | Уровень/поведение             |
|-----------------------|-----------|------|--------------------------------|
| Датчик уровня (вход)  | **D1**    | 5    | **LOW = ПОЛНЫЙ** (вход с `INPUT_PULLUP`) |
| Насос (реле, выход)   | **D2**    | 4    | **HIGH = ВКЛ**                 |
| Factory Reset (вход)  | **D7**    | 13   | Держать **LOW** при старте ~5 c |
| Встроенный LED        | —         | 2    | Активен по **LOW**             |

> Подключайте датчик уровня так, чтобы при «полный бак» он **тянул вход к GND**.
